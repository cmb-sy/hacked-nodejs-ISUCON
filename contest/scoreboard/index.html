<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#667eea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <title>Scoreboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        min-height: 100dvh; /* Dynamic viewport height for mobile */
        margin: 0;
        padding: 20px;
        text-align: center;
        -webkit-overflow-scrolling: touch;
      }

      h1 {
        color: #fff;
        font-size: clamp(24px, 5vw, 36px);
        margin-bottom: clamp(15px, 3vw, 30px);
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        word-break: break-word;
      }

      #timeline-chart,
      #bar-chart {
        background-color: #fff;
        border-radius: 12px;
        padding: clamp(10px, 2vw, 20px);
        margin: clamp(10px, 2vw, 20px) auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        max-width: 100%;
        width: calc(100% - clamp(16px, 4vw, 40px));
        overflow-x: hidden;
        overflow-y: visible;
        display: flex;
        flex-direction: column;
        align-items: center;
        -webkit-overflow-scrolling: touch;
      }

      #timeline-chart svg,
      #bar-chart svg {
        width: 100% !important;
        height: auto !important;
        display: block;
      }

      #bar-chart {
        max-height: 80vh;
        max-height: 80dvh;
        overflow-y: auto;
        overflow-x: hidden;
        position: relative;
      }

      #bar-chart::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      #bar-chart::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      #bar-chart::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }

      #bar-chart::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      #bar-chart h2 {
        position: sticky;
        top: 0;
        background-color: #fff;
        z-index: 10;
        padding-bottom: 10px;
        margin-bottom: 10px;
        width: 100%;
      }

      svg {
        margin: 0 auto;
        display: block;
        width: 100%;
        max-width: 100%;
        height: auto;
        touch-action: pan-x pan-y;
      }

      text {
        font-size: clamp(10px, 1.5vw, 12px);
        fill: #555;
      }

      .score-label {
        font-weight: bold;
        font-size: clamp(9px, 1.2vw, 11px);
      }

      .tooltip-modern {
        position: absolute;
        background-color: rgba(0, 0, 0, 0.85);
        color: #fff;
        padding: 8px 10px;
        border-radius: 6px;
        font-size: clamp(12px, 1.5vw, 14px);
        pointer-events: none;
        box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        max-width: 90vw;
        word-wrap: break-word;
      }

      .tick line {
        stroke: #ddd;
        stroke-opacity: 0.3;
      }

      h2 {
        font-size: clamp(18px, 3vw, 24px);
        color: #333;
        margin-bottom: clamp(10px, 2vw, 20px);
        font-weight: 600;
      }

      .axis-label {
        font-size: clamp(12px, 1.5vw, 14px);
        fill: #666;
        font-weight: 500;
      }

      #ranking-table {
        background-color: #fff;
        border-radius: 12px;
        padding: clamp(10px, 2vw, 20px);
        margin: clamp(10px, 2vw, 20px) auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        max-width: 100%;
        width: calc(100% - clamp(16px, 4vw, 40px));
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .ranking-table {
        width: 100%;
        border-collapse: collapse;
        margin: 0 auto;
        font-size: clamp(12px, 1.5vw, 14px);
      }

      .ranking-table th,
      .ranking-table td {
        padding: clamp(8px, 1.5vw, 12px) clamp(8px, 2vw, 16px);
        white-space: nowrap;
      }

      .ranking-table thead th {
        border-bottom: 2px solid #667eea;
      }

      .ranking-table tbody tr {
        border-bottom: 1px solid #eee;
      }

      .ranking-table tbody tr:last-child {
        border-bottom: none;
      }

      .ranking-table tbody tr:hover {
        background-color: #f8f9fa !important;
      }

      @keyframes pulse {
        0%,
        100% {
          background-color: inherit;
        }
        50% {
          background-color: #fffacd;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 8px;
        }

        #timeline-chart,
        #bar-chart,
        #ranking-table {
          padding: 8px;
          margin: 8px auto;
          border-radius: 8px;
        }

        .ranking-table th,
        .ranking-table td {
          padding: 6px 8px !important;
          font-size: 11px;
        }

        .tooltip-modern {
          font-size: 11px;
          padding: 6px 8px;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        #timeline-chart,
        #bar-chart,
        #ranking-table {
          padding: 10px;
          margin: 10px auto;
          max-width: 100%;
        }

        .ranking-table th,
        .ranking-table td {
          padding: 8px 10px !important;
        }
      }

      @media (min-width: 769px) and (max-width: 1024px) {
        #timeline-chart,
        #bar-chart,
        #ranking-table {
          padding: 15px;
        }
      }

      /* Landscape orientation adjustments */
      @media (max-height: 500px) and (orientation: landscape) {
        #timeline-chart,
        #bar-chart {
          max-height: 70vh;
        }
      }

      /* High DPI displays */
      @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        svg text {
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }
      }

      /* Reduce motion for accessibility */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <h1>ISUCON Scoreboard</h1>

    <div id="ranking-table"></div>
    <div id="timeline-chart"></div>
    <div id="bar-chart"></div>

    <!-- Use module type for JavaScript files -->
    <script type="module" src="./dist/main.js"></script>
  </body>
</html>
